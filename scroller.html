<!DOCTYPE html>
<html>
<head data-page="user_login" path="">
<title>scroller</title>
<style type="text/css">
*{margin:0;padding:0;border:none;color:white;}
.J-wrap{
  -webkit-transform-style: preserve-3d;-webkit-backface-visibility:hidden;
  position:relative;overflow:hidden;height:320px;border:1px solid white;
  width:300px;
}
.J-scroll{
	position:absolute;width:100%;
	-webkit-backface-visibility:hidden;-webkit-perspective: 1000;
	-webkit-transform: translateY(0px);-webkit-transform-style: preserve-3d;
}
.J-scroll li{height:40px;line-height: 40px;text-align: center}
</style>
</head>
<body style="background:#333">
<div class="J-wrap">
	<div id="J-scroll" class="J-scroll">
		<ul>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
		</ul>
	</div>
</div>

<br/><br/>

<div class="J-wrap">
	<div id="J-scroll2" class="J-scroll">
		<ul>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
			<li><a href="#">items block</a></li>
		</ul>
	</div>
</div>
<script>
;(function(win,D,undefined){

	function scroller(ele,options){
		this.lay=D.getElementById(ele);
		if(!this.lay){return}
		this.wrapperHeight =this.lay.parentNode.clientHeight;
		this.scrollerHeight =this.lay.offsetHeight;
		this.maxScrollY = this.wrapperHeight - this.scrollerHeight;
		this.y = 0;
		if(this.scrollerHeight<=this.wrapperHeight){return}
		this.setup();
	};

	scroller.prototype={
		setup:function(args){

				var type=args?'removeEventListener':'addEventListener';

				args && this.scrollTo(0,0);
				this.lay[type]('touchstart', this, false);
				this.lay[type]('touchmove', this, false);
				this.lay[type]('touchend', this, false);
				this.lay[type]('touchcancel', this, false);
				this.lay[type]('webkitTransitionEnd', this, false);
				win[type]('onorientationchange' in win ? 'orientationchange' : 'resize',this,false);

		},
		handleEvent: function(e) {
			switch (e.type) {
			  case 'touchstart': this.onStart(e); break;
			  case 'touchmove': this.onMov(e); break;
			  case 'touchcancel' :
			  case 'touchend': this.onEnd(e); break;
			  case 'webkitTransitionEnd':this._transitionEnd(e);break
			  case 'resize':
			  case 'orientationchange':this._resize(e);break;
			}
		},
		onStart:function(e){
			this.start=true;
			this._transitionTime();
			this.startTime = +new Date;
			if (this.isInTransition) {
				this._translate(this.gostop().y);
			}
			this.startY = this.y;
			this.pointY = e.touches[0].pageY;
		},
		onMov:function(e){
			e.preventDefault();
			if(this.start){
				var deltaY = e.touches[0].pageY - this.pointY,timestamp =  +new Date,newY;
				this.pointY = e.touches[0].pageY;
				newY = this.y + deltaY;

				if(newY>0||newY<this.maxScrollY){
					newY=this.y+deltaY/4;
				}
				
				this._translate(newY);
			}
		},
		onEnd:function(e){
			var point = e,momentumY,duration = +new Date - this.startTime,newY = Math.round(this.y),
			distanceY = Math.abs(newY - this.startY),time = 0;
			this.isInTransition = 0;
			this.start=false;
			if (this.resetPosition()) {return}
			if (duration < 300) {
				momentumY = momentum(this.y, this.startY, duration, this.maxScrollY,this.wrapperHeight);//可以省略
				newY = momentumY.destination;
				time = Math.max(momentumY.duration);
				this.isInTransition = 1;
			}
			if (newY != this.y) {
				this.scrollTo(newY,time);
				return;
			}
			
		},
		_transitionEnd:function(){
		  if (this.resetPosition()) {return;}
			this.isInTransition = 0;
		},
		gostop:function () {
			var matrix = window.getComputedStyle(this.lay, null), x, y;
			matrix = matrix['-webkit-transform'].split(')')[0].split(', ');
			y = +(matrix[13] || matrix[5]);
			return {y: y };
		},
		_translate: function (y){
			this.lay.style.webkitTransform ='translateY('+ y + 'px)';
			this.y = y;
		},
		_transitionTimingFunction:function (easing) {
			this.lay.style.webkitTransitionTimingFunction = 'cubic-bezier(0.1, 0.57, 0.1, 1)';
		},
		_transitionTime:function (time) {
			time = time || 0;
			this.lay.style.webkitTransitionDuration = time + 'ms';
		},
		scrollTo:function(y,time){
			  this._transitionTimingFunction();
			  this._transitionTime(time);
			  this._translate(y);
		},
		resetPosition: function (time) {
			var y = this.y;time = time || 0;
			if (this.y > 0) {y = 0;} else if (this.y < this.maxScrollY) {y = this.maxScrollY;}
			if (y == this.y) {return false;}
				this.scrollTo(y,600)
				return true;
      },
	  refresh: function () {
			if(!this.lay){return}
			var rf = this.lay.offsetHeight;
			this.wrapperHeight =this.lay.parentNode.clientHeight;//可见高度
			this.scrollerHeight =this.lay.offsetHeight;//内部实际高度
			this.maxScrollY = this.wrapperHeight - this.scrollerHeight;
			if(this.scrollerHeight<=this.wrapperHeight){
				this.setup('off');
				return;
			}else{
				this.setup();
				this.resetPosition();
			}		
    },
	  _resize: function (e) {
        var that = this;
        clearTimeout(this.resizeTimeout);
        this.resizeTimeout = setTimeout(function () {
           that.refresh();
        },17);
    },
    html:function(str){
    	this.refresh()
    }
	}

	function momentum(current, start, time, lowerMargin, wrapperSize) {
			/* from iscroll */
			var distance = current - start,
			speed = Math.abs(distance) / time,
			destination,
			duration,
			deceleration = 0.00096;
			destination = current + (speed * speed) / (2 * deceleration) * (distance < 0 ? -1 : 1);
			duration = speed / deceleration;
			if (destination < lowerMargin) {
			  destination = wrapperSize ? lowerMargin - (wrapperSize / 2.5 * (speed / 8)) : lowerMargin;
			  distance = Math.abs(destination - current);
			  duration = distance / speed;
			} else if (destination > 0) {
			  destination = wrapperSize ? wrapperSize / 2.5 * (speed / 8) : 0;
			  distance = Math.abs(current) + destination;
			  duration = distance / speed;
			}
			return {
			  destination: Math.round(destination),
			  duration: duration
			}
	}

	function getTrans(){
			var str="-webkit-transform:translate(-10px,20px)";
			return str.match(/-?\d+(px)*?/g);
			//return str.match(/translate\((-?\d+)px,\s*(-?\d+)px\).*/g);
			//return parseInt(str.match(/,\s*(-?\d*px)/i)[1]);//需改进xy
	}

	window.scroller=scroller;

})(window,document);


var scroll=new scroller('J-scroll');
var scroll2=new scroller('J-scroll2');
</script>
</body>
</html>